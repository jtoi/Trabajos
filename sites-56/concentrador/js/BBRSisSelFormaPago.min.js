var errores=new Array();var numFormasPago=0;var sessionId="";var contextPath="/sis";var enviandoDatos=false;var formaPagoSel="";var req;function anadirLiteral(etiqueta,valor){var error=new Array();error[0]=etiqueta;error[1]=valor;errores[errores.length]=error}function getError(etiqueta){var noencontrado=true;var i=0;while(noencontrado&&i<errores.length){if(errores[i][0]==etiqueta){return errores[i][1]}i++}return""}function fijarNumFormasPago(valor){numFormasPago=valor}function fijarDatosSesion(idSesion,raizContexto){sessionId=idSesion;contextPath=raizContexto}function validar(){if(!enviandoDatos){formaPagoSel="";var i=0;for(i=0;i<numFormasPago;i++){if(document.formModalidad.Ds_Merchant_PayMethod[i].checked){formaPagoSel=document.formModalidad.Ds_Merchant_PayMethod[i].value}}if(formaPagoSel==""){alert(getError("msg16"));return}else{if(formaPagoSel=="O"){ocultaBoton();solicitaDatosAJAX()}else{ocultaBoton();fProcesandoPeticion("S");enviandoDatos=true;document.formModalidad.submit()}}}}function solicitaDatosAJAX(){if(!enviandoDatos){var url=contextPath+"/formaPagoAJAX"+sessionId;if(window.XMLHttpRequest){req=new XMLHttpRequest()}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP")}}req.open("POST",url,true);req.onreadystatechange=respuestaConsultaAJAX;req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");req.send("Ds_Merchant_PayMethod="+formaPagoSel)}}function respuestaConsultaAJAX(){if(req.readyState==4){var hayError=true;if(req.status==200){if(formaPagoSel=="O"){var urlOasys=dameValorElemento(req.responseXML,"urlOasys");var petOasys=dameValorElemento(req.responseXML,"petOasys");if(urlOasys&&urlOasys!=""&&petOasys&&petOasys!=""){hayError=false;document.frmOASYS.dato.value=petOasys;document.frmOASYS.action=urlOasys;ocultaBoton();fProcesandoPeticion("S");enviandoDatos=true;document.frmOASYS.submit()}}if(formaPagoSel=="V"){var urlVme=dameValorElemento(req.responseXML,"urlVme");if(urlVme&&urlVme!=""){var paramsVme=urlVme.substring(urlVme.indexOf("?"));var sessionIdVme=paramsVme.substring(paramsVme.indexOf("=")+1);hayError=false;document.frmVme.action=urlVme;document.frmVme.sessionId.value=sessionIdVme;ocultaBoton();fProcesandoPeticion("S");enviandoDatos=true;document.frmVme.submit()}}if(formaPagoSel=="S"){var urlSafetyPay=dameValorElemento(req.responseXML,"urlSafetyPay");if(urlSafetyPay&&urlSafetyPay!=""){var paramsSafetyPay=urlSafetyPay.substring(urlSafetyPay.indexOf("?"));var TokenID=paramsSafetyPay.substring(paramsSafetyPay.indexOf("=")+1);hayError=false;document.frmSAFETYPAY.action=urlSafetyPay;ocultaBoton();fProcesandoPeticion("S");enviandoDatos=true;document.frmSAFETYPAY.submit()}}}if(hayError){muestraBoton();alert(getError("msg15"));return}}}function cancelar(){ocultaBoton();fProcesandoPeticion("S");document.formTarjeta.bcancel.value=1;document.formTarjeta.submit()};