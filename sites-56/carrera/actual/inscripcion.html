<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
<head>
    <meta name="author" content="Julio Toirac (jtoirac@gmail.com)" />
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<title>Inscripción de Atletas</title>
	<link rel="stylesheet" href="css/layout.css" type="text/css" />
	<link rel="stylesheet" href="css/datepicker.css" type="text/css" />

	<script type="text/javascript" src="site/js/jquery.js"></script>
	<script type="text/javascript">
		var diasPorMes = new Array(12);
		diasPorMes[1] = 31;
		diasPorMes[2] = 29;
		diasPorMes[3] = 31;
		diasPorMes[4] = 30;
		diasPorMes[5] = 31;
		diasPorMes[6] = 30;
		diasPorMes[7] = 31;
		diasPorMes[8] = 31;
		diasPorMes[9] = 30;
		diasPorMes[10] = 31;
		diasPorMes[11] = 30;
		diasPorMes[12] = 31;

		function ValidDayMonth(dayNum, monthNum, yearNum){

			yearNum = parseInt(yearNum);
			if ((dayNum==0) || (monthNum==0) || (yearNum==0))return false;
			if ((isNaN(dayNum)) || isNaN(monthNum) || isNaN(yearNum))return false;
			if ((monthNum > 12) || (yearNum < 1900) || (yearNum > 2120))return false;
			if((dayNum > diasPorMes[monthNum]) || (monthNum == 2) && (dayNum > daysInFeb(yearNum))){
			   return false;     }
			else {	return true;}
		}

		function NotToday(dayNum, monthNum, yearNum,msg){
		  eldia = new Date();
		 if ((dayNum==eldia.getDate())&&((monthNum-1)==eldia.getMonth())&&(yearNum==eldia.getYear())){ return false;}
		 else return true;
		}

		function daysInFeb(year){ 
		  return (((year % 4 == 0) && ((!(year % 100 == 0)) || (year % 400 == 0))) ? 29:28); 
		}

		function isDate(s) {   
			dia = s.substring(0,s.indexOf('/'));
			mes = s.substring(s.indexOf('/')+1,s.lastIndexOf('/'));
			ano = s.substring(s.lastIndexOf('/')+1,s.length);
			if (ValidDayMonth(dia, mes, ano)){
			return true;}

		}

		$(document).ready(function(){
			$('input').css('text-transform','uppercase');
			$("#tipoD2").attr('checked',false);
			
			var toDay = new Date();
			var anoAct = toDay.getFullYear();
			//var licencia = false;
			
			var edad1 = (anoAct - 1);
			var edad6 = (anoAct - 6);
			var edad7 = (anoAct - 7);
			var edad8 = (anoAct - 8);
			var edad9 = (anoAct - 9);
			var edad10 = (anoAct - 10);
			var edad11 = (anoAct - 11);
			var edad12 = (anoAct - 12);
			var edad13 = (anoAct - 13);
			var edad15 = (anoAct - 15);
			var edad16 = (anoAct - 16);
			var edad17 = (anoAct - 17);
			var edad18 = (anoAct - 18);
			var edad19 = (anoAct - 19);
			var edad20 = (anoAct - 20);
			var edad35 = (anoAct - 35);
			var edad90 = (anoAct - 90);
			
			var arrDias = Array(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31);
			var arrMes = Array(1,2,3,4,5,6,7,8,9,10,11,12);
			$("#categoria1").attr('checked','checked');
			$("#ano").get(0).options.length = 0;
			arrAno = ano(edad6,edad1);
			for(var i=0;i<arrAno.length;i++){
				$("#ano").get(0).options[i] = new Option(arrAno[i]);
			}
			$(".cate").click(function(){
				switch ($(this).val()) {
					case '1':
						var arrAno = ano(edad6,edad1);
						$("#sexo1").attr("checked",false);
						$("#sexo2").attr("checked",false);
						break;
					case '2':
						var arrAno = ano(edad8,edad7);
						$("#sexo1").attr("checked",false);
						$("#sexo2").attr("checked",false);
						break;
					case '3':
						var arrAno = ano(edad12,edad11);
						$("#sexo1").attr("checked",false);
						$("#sexo2").attr("checked",false);
						break;
					case '4':
						var arrAno = ano(edad15,edad13);
						$("#sexo1").attr("checked",false);
						$("#sexo2").attr("checked",false);
						break;
					case '5':
						var arrAno = ano(edad90,edad16);
						$("#sexo1").attr("checked",'checked');
						$("#sexo2").attr("checked",'');
						camDni();
						break;
					case '6':
						var arrAno = ano(edad90,edad35);
						$("#sexo1").attr("checked",false);
						$("#sexo2").attr("checked",false);
						camDni();
						break;
					case '7':
						var arrAno = ano(edad90,edad16);
						$("#sexo1").attr("checked",'checked');
						$("#sexo2").attr("checked",'');
						camDni();
						break;
					case '8':
						var arrAno = ano(edad10,edad9);
						$("#sexo1").attr("checked",false);
						$("#sexo2").attr("checked",false);
						break;
					case '9':
						var arrAno = ano(edad19,edad16);
						$("#sexo2").attr("checked",'checked');
						$("#sexo1").attr("checked",'');
						break;
					case '10':
						var arrAno = ano(edad90,edad20);
						$("#sexo2").attr("checked",'checked');
						$("#sexo1").attr("checked",'');
						camDni();
						break;
					case '11':
						var arrAno = ano(edad90,edad20);
						$("#sexo2").attr("checked",'checked');
						$("#sexo1").attr("checked",'');
						camDni();
						break;
				}
				$("#ano").get(0).options.length = 0;
				for(i=0;i<arrAno.length;i++){
					$("#ano").get(0).options[i] = new Option(arrAno[i]);
				}
			});
			$("#mes").get(0).options.length = 0;
			for(i=0;i<arrMes.length;i++){
				$("#mes").get(0).options[i] = new Option(arrMes[i]);
			}
			$("#dia").get(0).options.length = 0;
			for(i=0;i<arrDias.length;i++){
				$("#dia").get(0).options[i] = new Option(arrDias[i]);
			}
			
			function camDni(){
				$("#tipoD2").attr('checked','checked');
				$(".tipoD1").hide();
				$(".tipoD3").hide();
			}
			
			function ano(ini,fin){
				var j = 0;
				var arr = Array();
				for (i=ini;i<=fin;i++) {
					arr[j++] = i;
				}
				return arr;
			}
			
			$(".edad6").html(edad6);
			$(".edad7").html(edad7);
			$(".edad10").html(edad10);
			$(".edad11").html(edad11);
			$(".edad12").html(edad12);
			$(".edad15").html(edad15);
			$(".edad13").html(edad13);
			$(".edad16").html(edad16);
			$(".edad17").html(edad17);
			$(".edad8").html(edad8);
			$(".edad9").html(edad9);
			$(".edad18").html(edad18);
			$(".edad19").html(edad19);
			$(".edad20").html(edad20);
			
			
			$("#categoria6").click(function(){$("#tipoD2").attr('checked',true);$(".aster").html('*');})
			$("#categoria7").click(function(){$("#tipoD2").attr('checked',true);$(".aster").html('*');})
			$("#categoria5").click(function(){$("#tipoD2").attr('checked',true);$(".aster").html('');})
			$("#categoria8").click(function(){$("#tipoD2").attr('checked',false);$(".aster").html('');})
			$("#categoria4").click(function(){$("#tipoD2").attr('checked',false);$(".aster").html('');})
			$("#categoria3").click(function(){$("#tipoD2").attr('checked',false);$(".aster").html('');})
			$("#categoria2").click(function(){$("#tipoD2").attr('checked',false);$(".aster").html('');})
			$("#categoria1").click(function(){$("#tipoD2").attr('checked',false);$(".aster").html('');})
			
			$("#acepto").click(function(){
				if (this.checked == true) $("#envia").show(); else $("#envia").hide();
			})
			
			$("#envia").click(function(){
				espera(1);
				var salida = false;
				var mensaje = '';
				var fechan = '';
				
				
				if ($("#carnet").val().length > 1 || $("#lic").val().length > 1) {
					var fecha = $("#ano").val();
					var carnet = $("#carnet").val();
					var lic = $("#lic").val();
					
					if (fecha.length > 1 && (carnet.length > 1 || lic.length > 1)) {
						$.post("client.php",{
							fecha:fecha,
							carnet:carnet,
							lic:lic
						},function(data){
							if($.isEmptyObject(data) === false) {
								var xml = data,
									xmlDoc = $.parseXML( xml ),
									$xml = $( xmlDoc ),
									$estado = $xml.find( "Estado" )
									,$mensaje = $xml.find('Mensaje')
									,$nombre = $xml.find('Nombre')
									,$apellidos = $xml.find('Apellidos')
									,$fnac = $xml.find('FechaNacimiento')
									,$sexo = $xml.find('Sexo')
									,$cp = $xml.find('CP')
								;
								//alert($estado.text());
								if($estado.text() == 'KO') {

									if ($.isEmptyObject($mensaje.text()) === false) 
										mensaje += $mensaje.texto();
									else 
										mensaje += 'Hay un error en los datos del Carnet, la Licencia o la fecha de Nacimiento,\nsus datos no han sido encontrados en nuestra Base de Datos.\n';
									salida = false;
								} else {
									($sexo.text() == '0') ? $('#sexo1').attr('checked','checked') : $('#sexo2').attr('checked','checked');
									if ($nombre.text().length > 0) $('#nombre').val($nombre.text());
									if ($apellidos.text().length > 0) $('#apellido').val($apellidos.text());
									if ($cp.text().length > 0) $('#cp').val($cp.text());
								}
								envia(mensaje);
							}
						});
						
					}
				} else {
					envia(mensaje);
				}
			})
			
		});
		
		function envia(mensaje) {
			var categoria = '0';
			var sexo = '';
			var dni = '';
			var valdni = '';
			var licencia = false;
			var lice = '';
			var mensaje = '';
			
			if ($('#categoria1').attr('checked')) categoria = '24';
			if ($('#categoria2').attr('checked')) categoria = '25';
			if ($('#categoria8').attr('checked')) categoria = '26';
			if ($('#categoria3').attr('checked')) categoria = '27';
			if ($('#categoria4').attr('checked')) categoria = '28';
			if ($('#categoria5').attr('checked')) {categoria = '30';}
			if ($("#categoria6").attr('checked')) {licencia = true;categoria = '32';}
			if ($("#categoria7").attr('checked')) {licencia = true;categoria = '33';}
			if ($('#categoria9').attr('checked')) categoria = '29';
			if ($("#categoria10").attr('checked')) {categoria = '31';}
			if ($("#categoria11").attr('checked')) {licencia = true;categoria = '34';}
			if (categoria == '0') {salida = false; mensaje += 'La prueba no puede quedarse vacía';}

			if ($('#sexo1').attr('checked')) sexo = 'M';
			if ($('#sexo2').attr('checked')) sexo = 'F';
			if (sexo == '') {salida = false; mensaje += "\nMarque la casilla de Sexo";}

			if ($("#nombre").val() != '') salida = true; else {salida = false; mensaje += '\nEl nombre no puede estar vacío';}
			if ($("#apellido").val() != '') salida = true; else {salida = false; mensaje += "\n"+'El apellido no puede estar vacío';}
			//if ($("#direccion").val() != '') salida = true; else {salida = false; mensaje += "\n"+'La dirección no puede estar vac�a';}
			//if ($("#localidad").val() != '') salida = true; else {salida = false; mensaje += "\n"+'La localidad no puede estar vac�a';}
			//if ($("#provincia").val() != '') salida = true; else {salida = false; mensaje += "\n"+'La provincia no puede estar vac�a';}
			if ($("#cp").val() != '') {
				if ($("#cp").val().length == 5) {
					if (isNaN($("#cp").val())) {salida = false; mensaje += "\n"+'El código postal debe tener 5 caracteres numéricos';} else salida = true;
				} else {salida = false; mensaje += "\n"+'El código postal debe tener 5 caracteres';}
			} else {salida = false; mensaje += "\n"+'El código postal no puede quedar vacío';}

			$("#fn").val($("#dia").val()+'/'+$("#mes").val()+'/'+$("#ano").val());
			if (isDate($("#fn").val())) {
				salida = true; 
			} else {salida = false; mensaje += "\n"+'La fecha es incorrecta';}

			//if ($("#pais").val() != '') salida = true; else {salida = false; mensaje += "\n"+'El pa�s no puede quedar vacío';}
			//if ($("#nacionalidad").val() != '') salida = true; else {salida = false; mensaje += "\n"+'La nacionalidad no puede estar vac�a';}
			if ($("#movil").val() != '') salida = true; else {salida = false; mensaje += "\n"+'El teléfono Móvil no puede quedar vacío';}
			if ($("#correo").val() != '') salida = true; else {salida = false; mensaje += "\n"+'El correo no puede quedar vacío';}

			if (categoria == '29' || categoria == '30' || categoria == '31' || categoria == '32' || categoria == '33' ) {
				if ($("#tipoD2").attr('checked')){ dni = '2'; salida = true;}
				else {salida = false; mensaje += "\nDebe seleccionar el documento de identidad";}
				
				if (dni == '1' || dni == '2' || dni == '3') {
					if($("#numdni").val() != '' ) {
						if($("#numdni").val().length < 11 ) {
							salida = true; valdni = $("#numdni").val();} else {salida = false; mensaje += "\n"+'El número de identificación no debe tener más de 10 caracteres';}
					} else {salida = false; mensaje += "\n"+'El número de identificación no puede estar vacío';}
				}
			}

			if (licencia && $('#club').val() == '') {salida = false; mensaje += "\n"+'El nombre del club no puede quedar vacío';}
			if (licencia && ($('#lic').val() == '' && $('#lic2').val() == '' )) {
				salida = false; mensaje += "\n"+'El número de licencia no puede quedar vacío';
			} else { 
				if ($('#lic').val() == '') lice = $('#lic2').val(); else lice = $('#lic').val();
			}

			if (salida && mensaje == '') {
				$("#envia").hide();
				$("#result").load('resultado.php', {
					catego: categoria
					,evento: 3
					,nombre: $("#nombre").val()
					,apellido: $("#apellido").val()
					,sexo: sexo
					,fn: $("#fn").val()
					,dni: dni
					,valdni: valdni
//					,valdniT: valdniT
//						,direccion: $("#direccion").val()
//						,localidad: $("#localidad").val()
					,cp: $("#cp").val()
//						,provincia: $("#provincia").val()
//						,pais: $("#pais").val()
//						,nac: $("#nacionalidad").val()
//						,tel: $("#tel").val()
					,movil: $("#movil").val()
					,correo: $("#correo").val()
					,carnet: $("#carnet").val()
//						,pin: $("#pin").val()
					,club: $("#club").val()
					,lic: lice
//						,nacional: $("#nacionalidad").val()
				});
				espera(0);
				$("#result").css({
					'display': 'inline',
					'position': 'absolute',
					'width': 250,
					'height': 150,
					'left': ($(window).width()/2)-125,
					'top': ($(document).scrollTop() + ($(window).height()/2))-75,
					'background-color': '#ffffff',
					'border': '5px double red',
					'color': '#000000',
					'line-height': 11,
					'text-align': 'center',
					'-moz-border-radius': '6px 6px',
					'webkit-border-radius': 6,
					'border-radius': 6,
					'font-size': 14
				}).fadeOut(4000);
				$("#reset").click();

			} else {espera(0);alert(mensaje);}
		}
		
		function espera(vis) {
			if (vis == 1)
				$("#espera").css({
					'left': ($(window).width()/2)-24,
					'top': ($(document).scrollTop() + ($(window).height()/2))-24,
					'display':'inline'
				}); else $("#espera").css({
					'display':'none'
				});
		}
	</script>
  </head>
  <body>
	  <div id="result"></div>
	  <div id="espera" style="display: none"><img src="images/ajax-loader.gif" width="48" height="48" /></div>
	  <form action="" method="post">
<div id="todo">
	<div id="todo1">
		<div id="div1">
			<span class="intro">Prueba en la que desea participar</span>
			<div class="intern">
				<div class="divid">
					<!--<input type="radio" name="categoria" class="cate" id="categoria1" value="1" /><label for="categoria1" >Txupete (<span class="edad6"></span> y posteriores)</label><br />
					<input type="radio" name="categoria" class="cate" id="categoria2" value="2" /><label for="categoria2" >Pre-benjamin (<span class="edad8"></span> y <span class="edad7"></span> )</label><br />-->
					<input type="radio" name="categoria" class="cate" id="categoria8" value="8" /><label for="categoria8" >Benjamin (<span class="edad10"></span> y <span class="edad9"></span> )</label><br />
					<input type="radio" name="categoria" class="cate" id="categoria3" value="3" /><label for="categoria3" >Alevin (<span class="edad12"></span> y <span class="edad11"></span> )</label><br />
					<input type="radio" name="categoria" class="cate" id="categoria4" value="4" /><label for="categoria4" >Infantil y Cadete (de <span class="edad15"></span> a <span class="edad13"></span>)</label><br />
					<input type="radio" name="categoria" class="cate" id="categoria9" value="9" /><label for="categoria9" >Juvenil Junior (de <span class="edad19"></span> a <span class="edad16"></span>)</label><br />
					<input type="radio" name="categoria" class="cate" id="categoria5" value="5" /><label for="categoria5" >Abierta Fem. (<span class="edad17"></span> y anteriores)</label><br />
					<!--<input type="radio" name="categoria" class="cate" id="categoria10" value="10" /><label for="categoria10" >Abierta Masc. (<span class="edad20"></span> y anteriores)</label><br />-->
				</div>
				<div class="divid">
					<h4>con licencia federativa</h4>
					<input type="radio" name="categoria" class="cate" id="categoria6" value="6" /><label for="categoria6" >Federadas (de <span class="edad17"></span> y anteriores)</label><br />
					<input type="radio" name="categoria" class="cate" id="categoria7" value="7" /><label for="categoria7" >Federadas en atletismo. (de <span class="edad17"></span> y anteriores)</label><br />
					<!--<input type="radio" name="categoria" class="cate" id="categoria11" value="11" /><label for="categoria11" >Federados/as Elite Masc. (de <span class="edad20"></span> y anteriores)</label><br />-->
				</div>
			</div>
		</div>
		<div id="div2">
			<span class="intro">Datos personales</span>
			<div class="intern">
				<input type="radio" name="equipo" id="equipos" value="s" /><label for="equipos">Equipo</label><br />
				<input type="radio" name="equipo" id="equipon" value="n" checked='checked' /><label for="equipon">Individual para formar equipo 
					<span style="font-size: 10px;">(El equipo lo designará la organización y se comunicará el día de retirar la dorsal).</span></label><br />
				<div class="intForm">
					<div style="width: 150px;margin-right: 20px;">Nombre:* <br /><input style="width: 100%" type="text" id="nombre" /> </div>
					<div style="width: 320px">Apellidos:*<br /><input style="width: 100%" type="text" id="apellido" /></div>
					<div style="width: 200px;margin-right: 20px;margin-top: 10px;">Fecha Nac.:*
						<table width="100%" border="0">
							<tr>
								<td>Día</td>
								<td>Mes</td>
								<td>Año</td>
							</tr>
							<tr>
								<td><select id="dia"></select></td>
								<td><select id="mes"></select></td>
								<td><select id="ano"></select></td>
							</tr>
						</table>
						<input type="hidden" id="fn" /> <!--<span style="font-size: 10px">(dd/mm/yyyy)</span>--> </div>
					<div style="width: 260px"><br />Sexo:* <br /><input type="radio" name="sexo" id="sexo1" value="M" /><label for="sexo1" >Masculino</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="sexo" id="sexo2" value="F" /><label for="sexo2" >Femenino</label></div>
					<hr />
					<div style="width: 280px">Tipo documento: *<br />
						<input type="radio" name="tipo" id="tipoD2" class="tipoD2" /><label class="tipoD2" for="tipoD2" >DNI</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					</div>
					<div style="width: 200px;margin-right: 20px;"><br />Num.:*<br /><input style="width: 100%" type="text" id="numdni" /></div>
					<hr /><!--
					<div style="width: 490px">Direcci�n:*<br /><input style="width: 100%" type="text" id="direccion" /></div>
					<div style="width: 200px;margin-right: 20px;"><br />Localidad:*<br /><input style="width: 100%" type="text" id="localidad" /></div>-->
					<div style="width: 490px;"><div style="width: 100px"><br />C. Postal:*<br /><input style="width: 100%" maxlength="5" type="text" id="cp" /></div></div><!--
					<div style="width: 200px;margin-right: 20px;"><br />Provincia:*<br /><input style="width: 100%" type="text" id="provincia" /></div>
					<div style="width: 100px"><br />Pa�s:*<br /><input style="width: 100%" type="text" id="pais" /></div>
					<div style="width: 490px"><br />Nacionalidad:*<br /><input style="width: 100%" type="text" id="nacionalidad" /></div>
					<hr />
					<div style="width: 150px;margin-right: 20px;">Tel. Fijo<br /><input style="width: 100%" type="text" id="tel" /></div>-->
					<div style="width: 320px"><br />Tel. Móvil:*<br /><input style="width: 100%" type="text" id="movil" /></div>
					<div style="width: 490px"><br />E-mail:*<br /><input style="width: 100%" type="text" id="correo" /></div>
				</div>
			</div>
			<span class="oblig">* campos obligatorios</span>
		</div>
		<div id="div3">
			<span class="intro">Datos deportivos</span>
			<div class="intern">
				<div class="intForm">
					<div style="width: 490px">Si eres titular del Carnet Corredor Plus (en vigor el día de la prueba), introduce tu número de Carnet:</div>
					<div style="width: 200px;margin-right: 20px;"><input style="width: 100%" type="text" id="carnet" /></div>
					<!--<div style="width: 100px">Pin:<br /><input style="width: 100%" type="text" id="pin" /></div>-->
					<div style="width: 490px"><br />Club / Colegio: <span class="aster"></span><br /><input style="width: 100%" type="text" id="club" /></div>
					<div style="width: 490px"><br />Licencia Federativa Nacional (en mayúsculas, sin espacios ni símbolos) ej: BI5614: <span class="aster"></span><br /><input style="width: 100%" type="text" id="lic" /></div>
					<div style="width: 490px"><br />Licencia Federativa Autonómica (en mayúsculas, sin espacios ni símbolos) ej: BI5614: <span class="aster"></span><br /><input style="width: 100%" type="text" id="lic2" /></div>
				</div>
			</div>
		</div>
		<div id="div4">
			<span class="intro">Finalizar Inscripción</span>
			<div class="intern">
				<div class="intForm">
					<div class="largo"><input type="checkbox" id="acepto" />
						<label for="acepto" >He leído y acepto las <a href="Confidencialidad de Datos y Privacidad.pdf" >condiciones legales</a> y el <a href="Reglamento.pdf">reglamento</a></label><br /></div>
					<div class="ultimo largo">
						<input style="display: none" type="button" value="Enviar datos" id="envia" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id="reset" type="reset" value="Borrar Todo" />
					</div>
				</div>
			</div>
		</div>
	</div>
</div></form>
  </body>
</html>
